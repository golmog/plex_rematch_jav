# plex_rematch_jav.yaml
# ======================================================================
# Plex Rematch JAV 스크립트 설정 파일
# ======================================================================

# --- 필수 설정 ---
# 스크립트 실행에 반드시 필요한 값들입니다.
# 실제 환경에 맞게 경로와 토큰을 수정해주세요.

# Plex 데이터베이스 파일의 전체 경로
PLEX_DB: "/PATH/TO/YOUR/PLEX/Library/Application Support/Plex Media Server/Plug-in Support/Databases/com.plexapp.plugins.library.db"

# Plex 서버 접속 URL (예: http://localhost:32400, http://192.168.1.10:32400)
PLEX_URL: "http://127.0.0.1:32400"

# Plex 접근 토큰 (Plex 서버에서 확인 가능)
PLEX_TOKEN: "_YOUR_PLEX_TOKEN_" # !!! 반드시 실제 유효한 토큰으로 변경하세요 !!!

# Plex Dance 설정
# Plex Dance 실행 시 파일을 잠시 이동시켜 둘 임시 폴더 경로입니다.
# Plex 라이브러리 폴더와는 다른, 안전한 경로를 지정하세요.
PLEX_DANCE_TEMP_PATH: "/path/to/your/temp_dance_folder"
# Plex Dance 후 아이템이 라이브러리에 다시 나타날 때까지 기다리는 최대 시간 (초)
PLEX_DANCE_REAPPEAR_TIMEOUT: 600
# 아이템 존재 여부를 다시 확인하는 주기 (초)
PLEX_DANCE_REAPPEAR_INTERVAL: 5
# 휴지통 비우기 타임아웃 (초)
PLEX_DANCE_EMPTY_TRASH_TIMEOUT: 300,
# 휴지통 비우기 확인 주기 (초)
PLEX_DANCE_EMPTY_TRASH_INTERVAL: 5,


# --- 선택적 설정 ---
# 값을 지정하지 않으면 스크립트 내의 FALLBACK 기본값 또는 명령행 인자 기본값이 사용됩니다.
# 특정 설정을 스크립트 기본값으로 사용하고 싶다면 해당 라인을 주석 처리(#) 하거나 삭제하세요.

# 완료된 작업 기록용 데이터베이스 파일 경로
# 스크립트 실행 위치에 상대 경로로 지정하거나, 절대 경로로 지정할 수 있습니다.
COMPLETION_DB: "plex_rematch_jav.db"
# 예시 (절대 경로): COMPLETION_DB: "/home/user/scripts/plex_rematch_jav.db"

# 동시에 실행할 작업자(워커) 수 (자동 재매칭 모드용)
WORKERS: 2

# 각 아이템 처리 후 다음 아이템 처리 전 대기 시간 (초)
# API 요청이 너무 잦아 발생하는 문제를 피하기 위해 사용합니다.
MATCH_INTERVAL: 2

# 처리할 최대 아이템 개수 (0이면 무제한)
# 자동 모드, 인터랙티브 검색 모드, fix-labels 모드 각각 독립적으로 적용됩니다.
MATCH_LIMIT: 0 # 테스트 시 작은 값으로 설정 유용 (예: 10)

# Plex API 매칭 후보의 최소 점수 (0-100)
# 이 점수 미만인 후보는 자동 선택에서 제외됩니다.
SCORE_MIN: 95

# 스캔 관련 설정
SCAN_DEPTH: 2
SCAN_PATH_MAPPING_ENABLED: False
SCAN_PATH_MAP: "/path/on/script_host:/path/on/plex_host" # "/path/on/script_host:/path/on/plex_host" 세미콜론 구분으로 여러 경로 매핑 가능

# --- 고급 설정 (필요시 조절) ---

# 메타데이터 업데이트 후 Plex DB 반영 확인 시도 횟수
CHECK_COUNT: 10

# 메타데이터 업데이트 후 Plex DB 반영 확인 간격 (초)
CHECK_INTERVAL: 3

# Plex API GET 요청 타임아웃 (초)
REQUESTS_TIMEOUT_GET: 30

# Plex API PUT 요청 타임아웃 (초)
REQUESTS_TIMEOUT_PUT: 60

# 품번의 숫자 부분을 0으로 패딩할 때 목표 길이 (비교용이므로 조정할 필요 없음)
# 예: 123 -> 00123 (NUMERIC_PADDING_LENGTH: 5 인 경우)
NUMERIC_PADDING_LENGTH: 5

# --move-no-meta 옵션 사용 시, 파일을 이동할 절대 경로
MOVE_NO_META_PATH: "/PATH/TO/MOVE/NO_META"


# --- 명령행 옵션으로 주로 제어되는 설정들 ---
# 아래 항목들은 보통 YAML 파일에 설정하기보다는,
# 스크립트 실행 시 명령행 옵션으로 필요에 따라 지정하는 것이 일반적입니다.
# 특정 시나리오에서 항상 특정 옵션을 활성화하고 싶다면 여기에 설정할 수 있습니다.
# (DRY_RUN, FORCE_REMATCH, INCLUDE_COMPLETED, FIX_LABELS, MANUAL_SEARCH)

# 예시: 항상 드라이런으로 실행하고 싶다면
# DRY_RUN: true

# 예시: 항상 완료된 항목도 포함하고 싶다면
# INCLUDE_COMPLETED: true

# --- 품번 추출 규칙 ---
JAV_PARSING_RULES:
  # 일반(범용) 규칙
  generic_rules:
    - '.*?\d*([a-z]+)-(\d+)(?=[^\d]|\b) => {0}|{1}'
    - '.*?\d*([a-z]+)-?(\d+)(?=[^\d]|\b) => {0}|{1}'
    - '.*?\b([0-9a-z]*[a-z]+)-(\d+)(?=[^\d]|\b) => {0}|{1}'
    - '.*?\b([0-9a-z]*[a-z]+)-?(\d+)(?=[^\d]|\b) => {0}|{1}'

  # Censored용 특수 규칙
  censored_special_rules:
    # 3DSVR (예: [VCB] 13dsvr-039 -> 3DSVR-039)
    - '.*?(3dsvr)[-_]?(\d+)(?=[^\d]|\b) => {0}|{1}'
    # 741M...-G... (예: 741m683-g02 -> 741M683-G02)
    - '.*?(?<![a-z0-9])(741[a-z]\d{3})[-_]?(g\d{2,})(?=[^\d]|\b) => {0}|{1}'
    # T28/T38 (예: [Subs] 1t28-635 -> T28-635)
    - '.*?(?<![a-z])(t)[-_]?(28|38)[-_]?(\d+)(?=[^\d]|\b) => {0}{1}|{2}'
    # ID (예: 55id16045 -> 16ID-045)
    - '.*?(\d{2})?(id)[-_]?([1-9]\d|\d[1-9])(\d{3})(?=[^\d]|\b) => {2}{1}|{3}'
    # CPZ...-H... (예: [MyDir] 1cpz69h004 -> CPZ69-H004)
    - '.*?(?<![a-z])(cpz\d{2})[-_]?([a-z]\d+)(?=[^\d]|\b) => {0}|{1}'
    # GAREA (예: G-AREA-123 -> GAREA-123)
    - '.*?(?<![a-z])(g)[-_](area)[-_]?(\d+)(?=[^\d]|\b) => {0}{1}|{2}'
    # SCUTE (예: S-CUTE-1234 -> SCUTE-1234)
    - '.*?(?<![a-z])(s)[-_](cute)[-_]?(\d+)(?=[^\d]|\b) => {0}{1}|{2}'
    # MBRXX (예: MBR-AA-123 -> MBRAA-123)
    - '.*?(?<![a-z])(mar|mbr|mmr)[-_]([a-z]{2})[-_]?(\d+)(?=[^\d]|\b) => {0}{1}|{2}'
    # TOKYO (예: TOKYO247-123 -> TOKYO-123)
    - '.*?(?<![a-z])(tokyo)247[-_]?(\d+)(?=[^\d]|\b) => {0}|{1}'
    # WVR
    - '.*?(?<![a-z])(wvr[1-9])[-_]?([a-z]?\d{3,})\b => {0}|{1}'
    # YPP
    - '.*?((?:[0-9]{3})?ypp)[-_]?(\d+)(?=[^\d]|\b) => {0}|{1}'
    # 레이블 앞 3자리 숫자 유지
    - '.*?(\d{3})(ap|good|san|ten)[-_]?(\d+)(?=[^\d]|\b) => {0}{1}|{2}'
    # 레이블 앞 2자리 숫자 유지
    - '.*?(\d{2})(ap|id|ntrd|san|sora|sw|ten)[-_]?(\d{3,4})(?=[^\d]|\b) => {0}{1}|{2}'

# 배우 정보 DB(FF) 경로
ACTORS_DB_PATH: "/PATH/TO/jav_actors2.db"

# SJVA 에이전트 설정
# SJVA 에이전트의 기본 GUID 접두사입니다. 보통 수정할 필요 없습니다.
SJVA_AGENT_GUID_PREFIX: "com.plexapp.agents.sjva_agent://"

# JAV 사이트 약어와 SJVA 에이전트의 사이트 코드를 매핑합니다.
# 여기에 정의된 코드는 위의 SJVA_AGENT_GUID_PREFIX와 자동으로 조합됩니다.
# 예: dmm -> com.plexapp.agents.sjva_agent://CD
SITE_CODE_MAP:
  dmm:
    - CD
    - YMCD
  mgs:
    - CM
    - YMCM
  jav321:
    - CT
    - YMCT
  javbus:
    - CB
    - YMCB
  javdb:
    - CJ
    - YMCJ

